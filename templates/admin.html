<!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Qu·∫£n tr·ªã - L'Oreal Paris</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&amp;display=swap" rel="stylesheet"/>
<link href="/static/css/style.css" rel="stylesheet"/>
<style>
    body {
      background: #f8fafc;
    }
  
                /* Custom CSS Improvements */
                body {
                    font-family: 'Segoe UI', sans-serif;
                    background-color: #f4f7f6;
                    color: #333;
                    margin: 0;
                    padding: 0;
                    transition: all 0.3s ease;
                }
                h1, h2, h3 {
                    color: #333;
                    font-weight: bold;
                }
                .btn:hover {
                    background-color: #007bff;
                    color: white;
                    transition: all 0.3s ease;
                }
                .navbar {
                    background-color: #003366;
                }
                .navbar a {
                    color: #ffffff;
                }
                .navbar a:hover {
                    color: #f4f4f4;
                    text-decoration: underline;
                }
                .container {
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 20px;
                }
                .card {
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                    border-radius: 10px;
                    overflow: hidden;
                }
                .card-body {
                    padding: 20px;
                    background-color: #ffffff;
                }
                .fade-in {
                    animation: fadeIn 1.5s ease-in;
                }
                @keyframes fadeIn {
                    0% {
                        opacity: 0;
                    }
                    100% {
                        opacity: 1;
                    }
                }
                /* Responsive Design */
                @media (max-width: 768px) {
                    .container {
                        padding: 10px;
                    }
                }
            </style>
</head>
<body>
<!-- Header -->
<header class="header" style="position: relative; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
<div class="logo">L'Oreal Paris - Admin</div>
<nav class="nav">
<a href="/">V·ªÅ trang ch·ªß</a>
<span id="admin-greeting" style="margin-left: 20px; font-weight: bold;"></span>
<a href="#" onclick="logout()" style="margin-left: 20px;">ƒêƒÉng xu·∫•t</a>
</nav>
</header>
<div class="admin-container" style="margin-top: 100px;">
<!-- Admin Header -->
<div class="admin-header">
<h1 style="margin: 0; color: #2b6777;">B·∫£ng ƒëi·ªÅu khi·ªÉn qu·∫£n tr·ªã</h1>
<p style="margin: 8px 0 0; color: #6b7280;">Qu·∫£n l√Ω s·∫£n ph·∫©m, ng∆∞·ªùi d√πng v√† ƒë∆°n h√†ng</p>
</div>
<!-- Statistics -->
<div class="admin-stats">
<div class="admin-stat-card">
<div class="admin-stat-number" id="total-products">0</div>
<div class="admin-stat-label">S·∫£n ph·∫©m</div>
</div>
<div class="admin-stat-card">
<div class="admin-stat-number" id="total-users">0</div>
<div class="admin-stat-label">Ng∆∞·ªùi d√πng</div>
</div>
<div class="admin-stat-card">
<div class="admin-stat-number" id="total-orders">0</div>
<div class="admin-stat-label">ƒê∆°n h√†ng</div>
</div>
<div class="admin-stat-card">
<div class="admin-stat-number" id="total-contacts">0</div>
<div class="admin-stat-label">Tin nh·∫Øn</div>
</div>
</div>
<!-- Tabs -->
<div class="admin-tabs">
<button class="admin-tab active" onclick="switchTab('products')">S·∫£n ph·∫©m</button>
<button class="admin-tab" onclick="switchTab('users')">Ng∆∞·ªùi d√πng</button>
<button class="admin-tab" onclick="switchTab('orders')">ƒê∆°n h√†ng</button>
<button class="admin-tab" onclick="switchTab('contacts')">Tin nh·∫Øn</button>
</div>
<!-- Products Tab -->
<div class="admin-content" id="products-tab">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
<h2 style="margin: 0;">Qu·∫£n l√Ω s·∫£n ph·∫©m</h2>
<button class="admin-btn primary" onclick="openProductModal()">Th√™m s·∫£n ph·∫©m</button>
</div>
<table class="admin-table" id="products-table">
<thead>
<tr>
<th>ID</th>
<th>H√¨nh ·∫£nh</th>
<th>T√™n s·∫£n ph·∫©m</th>
<th>Gi√°</th>
<th>Danh m·ª•c</th>
<th>T·ªìn kho</th>
<th>N·ªïi b·∫≠t</th>
<th>Thao t√°c</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<!-- Users Tab -->
<div class="admin-content" id="users-tab" style="display: none;">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
<h2 style="margin: 0;">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
<button class="admin-btn primary" onclick="openUserModal()">Th√™m ng∆∞·ªùi d√πng</button>
</div>
<table class="admin-table" id="users-table">
<thead>
<tr>
<th>ID</th>
<th>T√™n</th>
<th>Li√™n h·ªá</th>
<th>Quy·ªÅn</th>
<th>Ng√†y t·∫°o</th>
<th>Thao t√°c</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<!-- Orders Tab -->
<div class="admin-content" id="orders-tab" style="display: none;">
<h2 style="margin: 0 0 20px;">Qu·∫£n l√Ω ƒë∆°n h√†ng</h2>
<table class="admin-table" id="orders-table">
<thead>
<tr>
<th>ID</th>
<th>Kh√°ch h√†ng</th>
<th>T·ªïng ti·ªÅn</th>
<th>Tr·∫°ng th√°i</th>
<th>Ng√†y ƒë·∫∑t</th>
<th>Thao t√°c</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<!-- Contacts Tab -->
<div class="admin-content" id="contacts-tab" style="display: none;">
<h2 style="margin: 0 0 20px;">Tin nh·∫Øn li√™n h·ªá</h2>
<table class="admin-table" id="contacts-table">
<thead>
<tr>
<th>ID</th>
<th>T√™n</th>
<th>Li√™n h·ªá</th>
<th>Tin nh·∫Øn</th>
<th>Ng√†y g·ª≠i</th>
<th>Tr·∫°ng th√°i</th>
<th>Thao t√°c</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
<!-- Product Modal -->
<div class="modal" id="product-modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title" id="product-modal-title">Th√™m s·∫£n ph·∫©m</h3>
<button class="modal-close" onclick="closeProductModal()">√ó</button>
</div>
<form class="admin-form" id="product-form">
<input id="product-id" type="hidden"/>
<div class="admin-form-group">
<label for="product-name">T√™n s·∫£n ph·∫©m</label>
<input id="product-name" required="" type="text"/>
</div>
<div class="admin-form-group">
<label for="product-price">Gi√° (VNƒê)</label>
<input id="product-price" min="0" required="" type="number"/>
</div>
<div class="admin-form-group">
<label for="product-category">Danh m·ª•c</label>
<select id="product-category" required="">
<option value="">Ch·ªçn danh m·ª•c</option>
</select>
</div>
<div class="admin-form-group">
<label for="product-stock">S·ªë l∆∞·ª£ng t·ªìn kho</label>
<input id="product-stock" min="0" required="" type="number"/>
</div>
<div class="admin-form-group">
<label for="product-image">URL h√¨nh ·∫£nh</label>
<input id="product-image" required="" type="url"/>
</div>
<div class="admin-form-group">
<label for="product-description">M√¥ t·∫£</label>
<textarea id="product-description" rows="4"></textarea>
</div>
<div class="admin-form-group">
<label>
<input id="product-featured" type="checkbox"/> S·∫£n ph·∫©m n·ªïi b·∫≠t
          </label>
</div>
<div style="display: flex; gap: 10px; justify-content: flex-end;">
<button class="admin-btn" onclick="closeProductModal()" type="button">H·ªßy</button>
<button class="admin-btn primary" type="submit">L∆∞u</button>
</div>
</form>
</div>
</div>
<!-- User Modal -->
<div class="modal" id="user-modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title" id="user-modal-title">Th√™m ng∆∞·ªùi d√πng</h3>
<button class="modal-close" onclick="closeUserModal()">√ó</button>
</div>
<form class="admin-form" id="user-form">
<input id="user-id" type="hidden"/>
<div class="admin-form-group">
<label for="user-name">T√™n</label>
<input id="user-name" required="" type="text"/>
</div>
<div class="admin-form-group">
<label for="user-contact">Email/S·ªë ƒëi·ªán tho·∫°i</label>
<input id="user-contact" required="" type="text"/>
</div>
<div class="admin-form-group">
<label for="user-password">M·∫≠t kh·∫©u</label>
<input id="user-password" required="" type="password"/>
</div>
<div class="admin-form-group">
<label>
<input id="user-admin" type="checkbox"/> Quy·ªÅn qu·∫£n tr·ªã
          </label>
</div>
<div style="display: flex; gap: 10px; justify-content: flex-end;">
<button class="admin-btn" onclick="closeUserModal()" type="button">H·ªßy</button>
<button class="admin-btn primary" type="submit">L∆∞u</button>
</div>
</form>
</div>
</div>
<!-- Order Details Modal -->
<div class="modal" id="order-modal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title" id="order-modal-title">Chi ti·∫øt ƒë∆°n h√†ng</h3>
<button class="modal-close" onclick="closeOrderModal()">√ó</button>
</div>
<div class="admin-form" id="order-details">
<!-- Order details will be loaded here -->
</div>
<div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
<button class="admin-btn" onclick="closeOrderModal()" type="button">ƒê√≥ng</button>
</div>
</div>
</div>
<script src="/static/js/main.js"></script>
<script>
    let currentTab = 'products';
    let categories = [];

    // Check admin access
    async function checkAdminAccess() {
      try {
        const response = await fetch('/api/user');
        if (response.ok) {
          const user = await response.json();
          if (!user.is_admin) {
            toast.error('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang n√†y');
            window.location.href = '/';
            return false;
          }
          document.getElementById('admin-greeting').textContent = `Xin ch√†o, ${user.name}`;
          return true;
        } else {
          toast.error('Vui l√≤ng ƒëƒÉng nh·∫≠p');
          window.location.href = '/login';
          return false;
        }
      } catch (error) {
        toast.error('C√≥ l·ªói x·∫£y ra');
        window.location.href = '/';
        return false;
      }
    }

    // Logout
    async function logout() {
      try {
        await fetch('/api/logout', { method: 'POST' });
        toast.success('ƒêƒÉng xu·∫•t th√†nh c√¥ng');
        setTimeout(() => {
          window.location.href = '/';
        }, 1000);
      } catch (error) {
        toast.error('C√≥ l·ªói x·∫£y ra khi ƒëƒÉng xu·∫•t');
      }
    }

    // Switch tabs
    function switchTab(tab) {
      // Update tab buttons
      document.querySelectorAll('.admin-tab').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Hide all tab contents
      document.querySelectorAll('[id$="-tab"]').forEach(content => content.style.display = 'none');
      
      // Show selected tab
      document.getElementById(tab + '-tab').style.display = 'block';
      currentTab = tab;
      
      // Load data for the tab
      loadTabData(tab);
    }

    // Load data for specific tab
    async function loadTabData(tab) {
      switch(tab) {
        case 'products':
          await loadProducts();
          break;
        case 'users':
          await loadUsers();
          break;
        case 'orders':
          await loadOrders();
          break;
        case 'contacts':
          await loadContacts();
          break;
      }
    }

    // Load statistics
    async function loadStats() {
      try {
        const [productsRes, usersRes, ordersRes, contactsRes] = await Promise.all([
          fetch('/api/admin/stats/products'),
          fetch('/api/admin/stats/users'),
          fetch('/api/admin/stats/orders'),
          fetch('/api/admin/stats/contacts')
        ]);

        if (productsRes.ok) {
          const data = await productsRes.json();
          document.getElementById('total-products').textContent = data.count;
        }
        if (usersRes.ok) {
          const data = await usersRes.json();
          document.getElementById('total-users').textContent = data.count;
        }
        if (ordersRes.ok) {
          const data = await ordersRes.json();
          document.getElementById('total-orders').textContent = data.count;
        }
        if (contactsRes.ok) {
          const data = await contactsRes.json();
          document.getElementById('total-contacts').textContent = data.count;
        }
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    // Load categories
    async function loadCategories() {
      try {
        const response = await fetch('/api/categories');
        if (response.ok) {
          categories = await response.json();
          const select = document.getElementById('product-category');
          select.innerHTML = '<option value="">Ch·ªçn danh m·ª•c</option>';
          categories.forEach(cat => {
            select.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
          });
        }
      } catch (error) {
        console.error('Error loading categories:', error);
      }
    }

    // Load products
    async function loadProducts() {
      try {
        const response = await fetch('/api/admin/products');
        if (response.ok) {
          const products = await response.json();
          const tbody = document.querySelector('#products-table tbody');
          tbody.innerHTML = '';
          
          products.forEach(product => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${product.id}</td>
              <td><img src="${product.image_url}" alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;"></td>
              <td>${product.name}</td>
              <td>${product.price.toLocaleString()}‚Ç´</td>
              <td>${product.category_name}</td>
              <td>${product.stock_quantity}</td>
              <td>${product.is_featured ? '‚úÖ' : '‚ùå'}</td>
              <td>
                <button class="admin-btn primary" onclick="editProduct(${product.id})">S·ª≠a</button>
                <button class="admin-btn danger" onclick="deleteProduct(${product.id})">X√≥a</button>
              </td>
            `;
            tbody.appendChild(row);
          });
        }
      } catch (error) {
        toast.error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch s·∫£n ph·∫©m');
      }
    }

    // Load users
    async function loadUsers() {
      try {
        const response = await fetch('/api/admin/users');
        if (response.ok) {
          const users = await response.json();
          const tbody = document.querySelector('#users-table tbody');
          tbody.innerHTML = '';
          
          users.forEach(user => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${user.id}</td>
              <td>${user.name}</td>
              <td>${user.contact}</td>
              <td>${user.is_admin ? 'Admin' : 'User'}</td>
              <td>${new Date(user.created_at).toLocaleDateString('vi-VN')}</td>
              <td>
                <button class="admin-btn primary" onclick="editUser(${user.id})">S·ª≠a</button>
                <button class="admin-btn danger" onclick="deleteUser(${user.id})" ${user.is_admin ? 'disabled' : ''}>X√≥a</button>
              </td>
            `;
            tbody.appendChild(row);
          });
        }
      } catch (error) {
        toast.error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch ng∆∞·ªùi d√πng');
      }
    }

    // Load orders
    async function loadOrders() {
      try {
        const response = await fetch('/api/admin/orders');
        if (response.ok) {
          const orders = await response.json();
          const tbody = document.querySelector('#orders-table tbody');
          tbody.innerHTML = '';
          
          orders.forEach(order => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${order.id}</td>
              <td>${order.customer_name}</td>
              <td>${order.total_amount.toLocaleString()}‚Ç´</td>
              <td>
                <select onchange="updateOrderStatus(${order.id}, this.value)">
                  <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Ch·ªù x·ª≠ l√Ω</option>
                  <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>ƒêang x·ª≠ l√Ω</option>
                  <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>ƒê√£ g·ª≠i</option>
                  <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>ƒê√£ giao</option>
                  <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>ƒê√£ h·ªßy</option>
                </select>
              </td>
              <td>${new Date(order.created_at).toLocaleDateString('vi-VN')}</td>
              <td>
                <button class="admin-btn primary" onclick="viewOrderDetails(${order.id})">Chi ti·∫øt</button>
              </td>
            `;
            tbody.appendChild(row);
          });
        }
      } catch (error) {
        toast.error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch ƒë∆°n h√†ng');
      }
    }

    // Load contacts
    async function loadContacts() {
      try {
        const response = await fetch('/api/admin/contacts');
        if (response.ok) {
          const contacts = await response.json();
          const tbody = document.querySelector('#contacts-table tbody');
          tbody.innerHTML = '';
          
          contacts.forEach(contact => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${contact.id}</td>
              <td>${contact.name}</td>
              <td>${contact.contact}</td>
              <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${contact.message}</td>
              <td>${new Date(contact.created_at).toLocaleDateString('vi-VN')}</td>
              <td>${contact.is_read ? '‚úÖ ƒê√£ ƒë·ªçc' : 'üìß Ch∆∞a ƒë·ªçc'}</td>
              <td>
                <button class="admin-btn primary" onclick="markAsRead(${contact.id})" ${contact.is_read ? 'disabled' : ''}>ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc</button>
              </td>
            `;
            tbody.appendChild(row);
          });
        }
      } catch (error) {
        toast.error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch tin nh·∫Øn');
      }
    }

    // Product Modal Functions
    function openProductModal(productId = null) {
      const modal = document.getElementById('product-modal');
      const title = document.getElementById('product-modal-title');
      const form = document.getElementById('product-form');
      
      if (productId) {
        title.textContent = 'S·ª≠a s·∫£n ph·∫©m';
        loadProductData(productId);
      } else {
        title.textContent = 'Th√™m s·∫£n ph·∫©m';
        form.reset();
        document.getElementById('product-id').value = '';
      }
      
      modal.classList.add('show');
    }

    function closeProductModal() {
      document.getElementById('product-modal').classList.remove('show');
    }

    async function loadProductData(productId) {
      try {
        const response = await fetch(`/api/products/${productId}`);
        if (response.ok) {
          const product = await response.json();
          document.getElementById('product-id').value = product.id;
          document.getElementById('product-name').value = product.name;
          document.getElementById('product-price').value = product.price;
          document.getElementById('product-category').value = product.category_id;
          document.getElementById('product-stock').value = product.stock_quantity;
          document.getElementById('product-image').value = product.image_url;
          document.getElementById('product-description').value = product.description;
          document.getElementById('product-featured').checked = product.is_featured;
        }
      } catch (error) {
        toast.error('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin s·∫£n ph·∫©m');
      }
    }

    // User Modal Functions
    function openUserModal(userId = null) {
      const modal = document.getElementById('user-modal');
      const title = document.getElementById('user-modal-title');
      const form = document.getElementById('user-form');
      
      if (userId) {
        title.textContent = 'S·ª≠a ng∆∞·ªùi d√πng';
        loadUserData(userId);
      } else {
        title.textContent = 'Th√™m ng∆∞·ªùi d√πng';
        form.reset();
        document.getElementById('user-id').value = '';
      }
      
      modal.classList.add('show');
    }

    function closeUserModal() {
      document.getElementById('user-modal').classList.remove('show');
    }

    async function loadUserData(userId) {
      try {
        const response = await fetch(`/api/admin/users/${userId}`);
        if (response.ok) {
          const user = await response.json();
          document.getElementById('user-id').value = user.id;
          document.getElementById('user-name').value = user.name;
          document.getElementById('user-contact').value = user.contact;
          document.getElementById('user-password').value = '';
          document.getElementById('user-admin').checked = user.is_admin;
        }
      } catch (error) {
        toast.error('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin ng∆∞·ªùi d√πng');
      }
    }

    // Order Modal Functions
    function openOrderModal() {
      document.getElementById('order-modal').classList.add('show');
    }

    function closeOrderModal() {
      document.getElementById('order-modal').classList.remove('show');
    }

    // Form submissions
    document.getElementById('product-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const productId = document.getElementById('product-id').value;
      const formData = {
        name: document.getElementById('product-name').value,
        price: parseFloat(document.getElementById('product-price').value),
        category_id: parseInt(document.getElementById('product-category').value),
        stock_quantity: parseInt(document.getElementById('product-stock').value),
        image_url: document.getElementById('product-image').value,
        description: document.getElementById('product-description').value,
        is_featured: document.getElementById('product-featured').checked
      };
      
      try {
        const url = productId ? `/api/admin/products/${productId}` : '/api/admin/products';
        const method = productId ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method: method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        
        if (response.ok) {
          toast.success(productId ? 'C·∫≠p nh·∫≠t s·∫£n ph·∫©m th√†nh c√¥ng' : 'Th√™m s·∫£n ph·∫©m th√†nh c√¥ng');
          closeProductModal();
          loadProducts();
          loadStats();
        } else {
          const error = await response.json();
          toast.error(error.error || 'C√≥ l·ªói x·∫£y ra');
        }
      } catch (error) {
        toast.error('C√≥ l·ªói x·∫£y ra khi l∆∞u s·∫£n ph·∫©m');
      }
    });

    document.getElementById('user-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const userId = document.getElementById('user-id').value;
      const formData = {
        name: document.getElementById('user-name').value,
        contact: document.getElementById('user-contact').value,
        password: document.getElementById('user-password').value,
        is_admin: document.getElementById('user-admin').checked
      };
      
      try {
        const url = userId ? `/api/admin/users/${userId}` : '/api/admin/users';
        const method = userId ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method: method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        
        if (response.ok) {
          toast.success(userId ? 'C·∫≠p nh·∫≠t ng∆∞·ªùi d√πng th√†nh c√¥ng' : 'Th√™m ng∆∞·ªùi d√πng th√†nh c√¥ng');
          closeUserModal();
          loadUsers();
          loadStats();
        } else {
          const error = await response.json();
          toast.error(error.error || 'C√≥ l·ªói x·∫£y ra');
        }
      } catch (error) {
        toast.error('C√≥ l·ªói x·∫£y ra khi l∆∞u ng∆∞·ªùi d√πng');
      }
    });

    // Edit functions
    function editProduct(productId) {
      openProductModal(productId);
    }

    function editUser(userId) {
      openUserModal(userId);
    }

    // Delete functions
    async function deleteProduct(productId) {
      if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')) {
        try {
          const response = await fetch(`/api/admin/products/${productId}`, {
            method: 'DELETE'
          });
          
          if (response.ok) {
            toast.success('X√≥a s·∫£n ph·∫©m th√†nh c√¥ng');
            loadProducts();
            loadStats();
          } else {
            const error = await response.json();
            toast.error(error.error || 'C√≥ l·ªói x·∫£y ra');
          }
        } catch (error) {
          toast.error('C√≥ l·ªói x·∫£y ra khi x√≥a s·∫£n ph·∫©m');
        }
      }
    }

    async function deleteUser(userId) {
      if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?')) {
        try {
          const response = await fetch(`/api/admin/users/${userId}`, {
            method: 'DELETE'
          });
          
          if (response.ok) {
            toast.success('X√≥a ng∆∞·ªùi d√πng th√†nh c√¥ng');
            loadUsers();
            loadStats();
          } else {
            const error = await response.json();
            toast.error(error.error || 'C√≥ l·ªói x·∫£y ra');
          }
        } catch (error) {
          toast.error('C√≥ l·ªói x·∫£y ra khi x√≥a ng∆∞·ªùi d√πng');
        }
      }
    }

    // Update order status
    async function updateOrderStatus(orderId, status) {
      try {
        const response = await fetch(`/api/admin/orders/${orderId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: status })
        });
        
        if (response.ok) {
          toast.success('C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng th√†nh c√¥ng');
        } else {
          const error = await response.json();
          toast.error(error.error || 'C√≥ l·ªói x·∫£y ra');
          loadOrders(); // Reload to reset the select
        }
      } catch (error) {
        toast.error('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t tr·∫°ng th√°i');
        loadOrders();
      }
    }

    // Mark contact as read
    async function markAsRead(contactId) {
      try {
        const response = await fetch(`/api/admin/contacts/${contactId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ is_read: true })
        });
        
        if (response.ok) {
          toast.success('ƒê√£ ƒë√°nh d·∫•u tin nh·∫Øn l√† ƒë√£ ƒë·ªçc');
          loadContacts();
          loadStats();
        } else {
          const error = await response.json();
          toast.error(error.error || 'C√≥ l·ªói x·∫£y ra');
        }
      } catch (error) {
        toast.error('C√≥ l·ªói x·∫£y ra');
      }
    }

    // View order details with modal
    async function viewOrderDetails(orderId) {
      try {
        const response = await fetch(`/api/admin/orders/${orderId}/details`);
        if (response.ok) {
          const order = await response.json();
          
          document.getElementById('order-modal-title').textContent = `Chi ti·∫øt ƒë∆°n h√†ng #${order.id}`;
          
          const orderDetailsHtml = `
            <div class="admin-form-group">
              <label><strong>Th√¥ng tin kh√°ch h√†ng</strong></label>
              <div style="background: #f9fafb; padding: 15px; border-radius: 6px; margin-top: 5px;">
                <p style="margin: 5px 0;"><strong>T√™n:</strong> ${order.customer_name}</p>
                <p style="margin: 5px 0;"><strong>ƒêi·ªán tho·∫°i:</strong> ${order.customer_phone}</p>
                <p style="margin: 5px 0;"><strong>ƒê·ªãa ch·ªâ:</strong> ${order.delivery_address}</p>
              </div>
            </div>
            
            <div class="admin-form-group">
              <label><strong>Th√¥ng tin ƒë∆°n h√†ng</strong></label>
              <div style="background: #f9fafb; padding: 15px; border-radius: 6px; margin-top: 5px;">
                <p style="margin: 5px 0;"><strong>Ph∆∞∆°ng th·ª©c thanh to√°n:</strong> ${order.payment_method}</p>
                <p style="margin: 5px 0;"><strong>Tr·∫°ng th√°i:</strong> ${order.status}</p>
                <p style="margin: 5px 0;"><strong>Ng√†y ƒë·∫∑t:</strong> ${new Date(order.created_at).toLocaleDateString('vi-VN')}</p>
                <p style="margin: 5px 0;"><strong>T·ªïng ti·ªÅn:</strong> <span style="color: #e91e63; font-weight: bold;">${order.total_amount.toLocaleString()}‚Ç´</span></p>
              </div>
            </div>
            
            <div class="admin-form-group">
              <label><strong>S·∫£n ph·∫©m ƒë√£ ƒë·∫∑t</strong></label>
              <div style="background: #f9fafb; padding: 15px; border-radius: 6px; margin-top: 5px;">
                ${order.items.map(item => `
                  <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                    <div>
                      <strong>${item.product_name}</strong><br>
                      <small>S·ªë l∆∞·ª£ng: ${item.quantity}</small>
                    </div>
                    <div style="text-align: right;">
                      <div>${item.price.toLocaleString()}‚Ç´ x ${item.quantity}</div>
                      <div style="font-weight: bold; color: #e91e63;">${(item.price * item.quantity).toLocaleString()}‚Ç´</div>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
          
          document.getElementById('order-details').innerHTML = orderDetailsHtml;
          openOrderModal();
        }
      } catch (error) {
        toast.error('Kh√¥ng th·ªÉ t·∫£i chi ti·∫øt ƒë∆°n h√†ng');
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', async function() {
      const hasAccess = await checkAdminAccess();
      if (hasAccess) {
        await loadCategories();
        await loadStats();
        await loadProducts();
      }
    });
  </script>
</body>
</html>
